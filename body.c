#pragma config(Sensor, S1,     lightSensor,    sensorLightActive)
#pragma config(Motor,  motorA,          leftWheel,     tmotorNXT, PIDControl, encoder)
#pragma config(Motor,  motorB,          rightWheel,    tmotorNXT, PIDControl, encoder)
//*!!Code automatically generated by 'ROBOTC' configuration wizard               !!*//

//--------------------------------------------------Variables

// Bluetooth Messages
const string ARM_START = "ARM_START";
const string ARM_EXIT = "ARM_EXIT";

// RobotC doesn't hoist functions, solve
// this by declaring functions above.
void moveWheels();
void stopWheels();
bool seeSushi();
void messageArm();
void waitForMessage();
void init();
void toNextSushi();
void exit();
void runSushiRobot();

//--------------------------------------------------Movement

// Moves the robot forward.
void moveWheels(int power);
// Stops the robot.
void stopWheels();

//--------------------------------------------------Vision

// Returns true if the light sensor detects
// sushi, and false otherwise.
bool seeSushi();

//--------------------------------------------------Bluetooth

// COMMAND    | CODE |  TRANSLATION
// -----------|------|-----------------------
// ARM_START  |  +1  |  Run arm cycle
// ARM_EXIT   |  -1  |  Exit arm program

// Sends a message to the arm controller.
void messageArm(const string command) {
	switch(command) {
		case ARM_START:
			sendMessage(1);
			break;
		case ARM_EXIT:
			sendMessage(-1);
			break;
		default:
			break;
	}
};
// Pauses the program while we wait for a
// message from the arm controller.
void waitForMessage() {
	waitUntil(message);
};

//--------------------------------------------------Utils

// Initialize system variables
void init();
// Moves forward until we hit sushi
void toNextSushi();
// Exit the program
// Send message code of -1 to arm to notify it to exit
void exit(){
	messageArm(ARM_EXIT);
	// Wait 1 second to make sure arm receives message.
	wait1Msec(1000);
	powerOff();
};

//--------------------------------------------------Main
// Runs a single cycle of the sushi program. We move forward
//
// 1) Move forward until robot sees sushi.
//	 - If we don't see sushi after a certain period
//     of time, exit the arm and body programs.
// 2) Send a message to arm to pickup and drop sushi.
// 3) Wait for message from arm
// 4) Restart loop
void nextCycle();

task main()
{

}
